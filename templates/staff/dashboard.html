<!-- templates/staff/dashboard.html -->

{% extends 'staff/base.html' %}
{% load form_extras %}  <!-- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ get_item -->
{% load form_filters %}  <!-- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ add_class -->

{% block content %}

<div class="container mx-auto px-4 py-6">
  <h1 class="text-2xl font-bold mb-6">–ì–ª–∞–≤–Ω–∞—è</h1>

  <!-- === –ì—Ä—É–ø–ø–∞: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ === -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4 pb-2 border-b">üë• –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg">–í—Å–µ–≥–æ</h3>
        <p class="text-2xl font-bold">{{ total_employees }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg text-green-700">–ê–∫—Ç–∏–≤–Ω—ã—Ö</h3>
        <p class="text-2xl font-bold">{{ active }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg text-red-700">–£–≤–æ–ª–µ–Ω–æ</h3>
        <p class="text-2xl font-bold">{{ dismissed }}</p>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="text-lg text-orange-700">–î–µ–∫—Ä–µ—Ç</h3>
        <p class="text-2xl font-bold">{{ maternity }}</p>
      </div>
    </div>
    <div class="mt-4">
      <a href="{% url 'employees_list' %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</a>
      <a href="{% url 'employee_create' %}" class="ml-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
    </div>
  </div>

  <!-- === –ì—Ä—É–ø–ø–∞: –°–≤–æ–±–æ–¥–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ === -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold mb-4 pb-2 border-b">üÜì –°–≤–æ–±–æ–¥–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h2>
    
    {% if free_equipment_summary.types %}
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border">
          <thead class="bg-gray-100">
            <tr>
              <th class="py-2 px-4 text-left">–¢–∏–ø</th>
              {% for office_key in free_equipment_summary.offices %}
                <th class="py-2 px-4 text-left">{{ office_labels|get_item:office_key }}</th>
              {% endfor %}
              <th class="py-2 px-4 text-left">–í—Å–µ–≥–æ</th>
            </tr>
          </thead>
          <tbody>
            {% for type_key in free_equipment_summary.types %}
            <tr class="border-t">
              <td class="py-2 px-4 font-medium">{{ equipment_type_labels|get_item:type_key }}</td>
              {% for office_key in free_equipment_summary.offices %}
                <td class="py-2 px-4 text-center">{{ free_equipment_summary.data|get_item:type_key|get_item:office_key|default:0 }}</td>
              {% endfor %}
              <!-- –í—Å–µ–≥–æ –ø–æ —Ç–∏–ø—É -->
              <td class="py-2 px-4 font-bold text-center">
                {% with type_total=0 %}
                  {% for office_key in free_equipment_summary.offices %}
                    {% with count=free_equipment_summary.data|get_item:type_key|get_item:office_key|default:0 %}
                      {% if count %}
                        {% widthratio type_total 1 1 as dummy %}<!-- workaround for adding to variable -->
                        {% widthratio count 1 1 as dummy2 %}
                        {% widthratio type_total 1 1 as type_total %}<!-- reset -->
                        {% widthratio count 1 1 as count_val %}
                        {% widthratio type_total 1 1 as type_total %}<!-- reset -->
                        {% widthratio count_val 1 1 as count_val %}<!-- reset -->
                        {% widthratio type_total|add:count_val 1 1 as type_total %}
                      {% endif %}
                    {% endwith %}
                  {% endfor %}
                  {{ type_total }}
                {% endwith %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-gray-500">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.</p>
    {% endif %}
    
    <div class="mt-4">
      <a href="{% url 'equipment_list' %}" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ø–∏—Å–∫—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è</a>
      <a href="{% url 'equipment_create' %}" class="ml-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">–î–æ–±–∞–≤–∏—Ç—å –¢–ú–¶</a>
    </div>
  </div>
</div>
{% endblock %}